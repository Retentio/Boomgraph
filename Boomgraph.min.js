// ┌────────────────────────────────────────────────────────────────────┐ \\ 
// │ Boomgraph                                                          │ \\ 
// ├────────────────────────────────────────────────────────────────────┤ \\ 
// │ Copyright © 2012 Antoine Guiral (http://twitter.com/antoineguiral) │ \\ 
// │ Copyright © 2012 Retent.io (http://retent.io)                      │ \\ 
// │ http://github.com/retentio/boomgraph                               │ \\ 
// ├────────────────────────────────────────────────────────────────────┤ \\ 
// │ For the full copyright and license information,                    | \\ 
// | please view the LICENSE file that was distributed                  | \\ 
// | with this source code.                                             │ \\ 
// └────────────────────────────────────────────────────────────────────┘ \\ 
var Area=function(){return function(b){var c=new Choopy(b);c.options.graph.dot.normal=0,c.options.graph.dot.hover=0,c.options.grid.y.startAt=0,c.parse(),c.normalize(),c.initDraw(),c.drawGrid();var d,e=function(a,b){return{xScale:c.draw.coord.scale.x.step,xFactor:.5+b}};for(var f=0,g=c.data.countSerie;f<g;f++){var h=c.options.color.serie[f%c.options.color.serie.length];d=c.drawLine(f,h,e),d.plots.toFront(),c.draw.sets.series.push(d.plots),c.draw.sets.pathes.push(d.lines)}for(var f=0,g=c.draw.sets.series.length;f<g;f++)c.hover(c.draw.sets.series[f]);c.fillPathes(),c.sortSeries()}}(),Bar=function(b){var c=new Choopy(b);c.options.grid.y.startAt=0,c.parse(),c.normalize(),c.initDraw(),c.drawGrid();var d=function(a,b){return{xScale:c.draw.coord.scale.x.step/(c.data.countSerie+.5),xFactor:a+b*(c.data.countSerie+.5)}},e;for(var f=0,g=c.data.countSerie;f<g;f++){var h=c.options.color.serie[f%c.options.color.serie.length];e=c.drawColumns(f,h,d),e.toFront(),c.draw.sets.series.push(e)}for(var f=0,g=c.draw.sets.series.length;f<g;f++)c.hover(c.draw.sets.series[f])};Raphael.fn.drawGrid=function(a,b,c,d,e,f,g){if(g)var h=["M",Math.round(a)+.5,Math.round(b)+.5,"L",Math.round(a+c-2)+.5,Math.round(b)+.5,Math.round(a+c-2)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b)+.5];else var h=[];var i=d/f.y.tickers;for(var j=0;j<=f.y.tickers;j++)if(j<f.y.tickers)for(var k=0,l=c/3;k<l;k++)k%2==0&&(h=h.concat(["M",a+k*3,Math.round(b+j*i)+.5,"l",3,0]));else h=h.concat(["M",a,Math.round(b+j*i)+.5,"l",c,0]);return this.path(h.join(","))},Raphael.el.isAbsolute=!0,Raphael.el._realColor=null,Raphael.el._last={x:0,y:0},Raphael.el.setRealColor=function(a){return this._realColor=a,this},Raphael.el.absolutely=function(){return this.isAbsolute=1,this},Raphael.el.relatively=function(){return this.isAbsolute=0,this},Raphael.el.moveTo=function(a,b){return this._last={x:a,y:b},this.attr({path:this.attrs.path+["m","M"][+this.isAbsolute]+parseFloat(a)+" "+parseFloat(b)})},Raphael.el.lineTo=function(a,b){return this._last={x:a,y:b},this.attr({path:this.attrs.path+["l","L"][+this.isAbsolute]+parseFloat(a)+" "+parseFloat(b)})},Raphael.el.cplineTo=function(a,b,c){return a>this._last.x?this.attr({path:this.attrs.path+["S",a-c,b,a,b]}):a==this._last.x?this.lineTo(a,b):this.attr({path:this.attrs.path+["S",a+c,b,a,b]}),this._last={x:a,y:b},this},Raphael.el.andClose=function(){return this.attr({path:this.attrs.path+"z"})},function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),typeof e=="function"&&f&&(e=e()))}),e=(e==null||e==d?a:e)+"",e},d=function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})};Raphael.fn.popup=function(a,b,c,e,f){e=String(e||"top-middle").split("-"),e[1]=e[1]||"middle";var g=5,h=c.getBBox(),i=Math.round(h.width),j=Math.round(h.height),k=Math.round(h.x)-g,l=Math.round(h.y)-g,m=Math.min(j/2,i/2,10),n={top:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}l-{right},0-{gap},{gap}-{gap}-{gap}-{left},0a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",bottom:"M{x},{y}l{left},0,{gap}-{gap},{gap},{gap},{right},0a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z",right:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}v{h4},{h4},{h4},{h4}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}l0-{bottom}-{gap}-{gap},{gap}-{gap},0-{top}a{r},{r},0,0,1,{r}-{r}z",left:"M{x},{y}h{w4},{w4},{w4},{w4}a{r},{r},0,0,1,{r},{r}l0,{top},{gap},{gap}-{gap},{gap},0,{bottom}a{r},{r},0,0,1,-{r},{r}h-{w4}-{w4}-{w4}-{w4}a{r},{r},0,0,1-{r}-{r}v-{h4}-{h4}-{h4}-{h4}a{r},{r},0,0,1,{r}-{r}z"},o={hx0:a-(k+g+i-m*2),hx1:a-(k+g+i/2-m),hx2:a-(k+g+m),vhy:b-(l+g+j+g+m),"^hy":b-(l-m)},p=[{x:k+g,y:l,w:i,w4:i/4,h4:j/4,right:0,left:i-m*2,bottom:0,top:j-m*2,r:g,h:j,gap:m},{x:k+g,y:l,w:i,w4:i/4,h4:j/4,left:i/2-m,right:i/2-m,top:j/2-m,bottom:j/2-m,r:g,h:j,gap:m},{x:k+g,y:l,w:i,w4:i/4,h4:j/4,left:0,right:i-m*2,top:0,bottom:j-m*2,r:g,h:j,gap:m}][e[1]=="middle"?1:(e[1]=="top"||e[1]=="left")*2],q=0,r=0,s=this.path(d(n[e[0]],p)).insertBefore(c);switch(e[0]){case"top":q=a-(k+g+p.left+m),r=b-(l+g+j+g+m);break;case"bottom":q=a-(k+g+p.left+m),r=b-(l-m);break;case"left":q=a-(k+g+i+g+m),r=b-(l+g+p.top+m);break;case"right":q=a-(k-m),r=b-(l+g+p.top+m)}return s.translate(q,r),f?(f=s.attr("path"),s.remove(),{path:f,dx:q,dy:r}):(c.translate(q,r),s)}}();var Choopy=function(){var a=function(b){if(Object.prototype.toString.call(b)=="[object Undefined]"||Object.prototype.toString.call(b.data)=="[object Undefined]"||b["data"]==""||Object.prototype.toString.call(b.data)=="[object Undefined]"||b.container=="")throw new Error("Empty data source or container is not allowed");var c=document.getElementById(b.container);if(c==null)throw new Error("There is no div container with this id :"+b.container);var d=this.utils.extend(this.utils.extend({},this.defaultOptions),b);this.options=function(){return d}(d),this.data={raws:[],series:[],labels:{x:[]},longestSerie:0,countSerie:0};if((this.options.height<=0||this.options.width<=0)&&this.options.auto_adjust!=1)throw new Error("Height and/or width needs to be superior to 0");if(this.options.auto_adjust==1||this.options.height==0||this.options.width==0)container=document.getElementById(this.options.container),this.options.height=container.offsetHeight,this.options.width=container.offsetWidth;var e=Raphael(this.options.container,this.options.width,this.options.height);this.draw={paper:e,sets:{series:[],transverses:[],pathes:[],labels:{x:[],y:[]},legend:[]},matrice:{},dots:[],tooltips:{},grid:{box:null,y:null,x:null},coord:{scale:{y:{minValue:0,maxValue:0,step:0,tickers:0},x:{step:0}},origin:{X:0,Y:0}}}};return a.prototype.setOptions=function(a){this.options=this.utils.extend(this.options,a)},a.prototype.parse=function(){if(Object.prototype.toString.call(this.options.data)=="[object Array]"){if(this.options.data.length==0)throw new Error("options.data shouldn't be empty");this.data.longestSerie=0;for(var a=0,b=this.options.data.length;a<b;a++)this.options.data[a].name=="x-label"?Object.prototype.toString.call(this.options.data[a].data)=="[object Function]"?this.data.labels.x=this.options.data[a].data():this.data.labels.x=this.options.data[a].data:(this.options.data[a].name=this.utils.trim(this.options.data[a].name),this.data.series.push(this.options.data[a]),this.options.data[a].data.length>this.data.longestSerie&&(this.data.longestSerie=this.options.data[a].data.length));if(this.data.labels.x.length>0)this.data.countSerie=b-1;else{var c=function(a){var b=[];for(var c=0,d=a;c<d;c++)b.push(c);return b};this.data.labels.x=c(this.data.longestSerie),this.data.countSerie=b}if(this.data.countSerie==0)throw new Error("you should pass at least one serie")}else{if(Object.prototype.toString.call(this.options.data)!="[object String]")throw new Error("options.data should be an array of series or an id");var d=document.getElementById(this.options.data);if(d==null)throw new Error("No data provided. Check if the id match a well formed html table");var e=[],f=d.getElementsByTagName("tr");for(var a=0;a<f.length;a++){var g=[],h=f[a];if(h.getElementsByTagName("th")){var i=h.getElementsByTagName("th");for(var j=0,k=i.length;j<k;j++)g.push(this.utils.trim(i[j].textContent))}if(h.getElementsByTagName("td")){var i=h.getElementsByTagName("td");for(var j=0,k=i.length;j<k;j++)g.push(this.utils.trim(i[j].textContent))}e.push(g)}this.data.raws=e}},a.prototype.transversalize=function(){var a=this.data.raws,b=[];for(var c=0,d=a.length;c<d;c++)for(var e=0,f=a[c].length;e<f;e++)c==0&&b.push([]),b[e][c]=a[c][e];this.data.raws=b},a.prototype.normalize=function(){var a=this.data.raws;if(a.length==1){var b={name:"",data:[]};this.data.series.push(b);for(var c=0,d=a[0].length;c<d;c++)c==0?this.data.series[0].name=a[0][c]:this.data.series[0].data.push(parseFloat(a[0][c]));this.data.longestSerie=a[0].length-1,this.data.countSerie=1;var e=function(a){var b=[];for(var c=0,d=a;c<d;c++)b.push(c);return b};this.data.labels.x=e(this.data.longestSerie)}else{for(var f=0,g=a.length;f<g;f++){if(f>0){var b={name:"",data:[]};this.data.series.push(b)}for(var c=0,d=a[f].length;c<d;c++)f==0?c>0&&this.data.labels.x.push(a[f][c]):(c==0?this.data.series[f-1].name=a[f][c]:this.data.series[f-1].data.push(parseFloat(a[f][c])),this.data.longestSerie<d-1&&(this.data.longestSerie=d-1))}this.data.countSerie=this.data.series.length}},a.prototype.initDraw=function(){this.options.legend.display=="top"?this.drawLegendTop():this.options.legend.display=="right"&&this.drawLegendRight(),this.draw.coord.origin.X=this.options.offset.left+this.options.gutter.left+.5,this.draw.coord.origin.Y=this.options.gutter.top+.5;var a=this.data.series[0].data[0],b;this.options.grid.y.startAt!==!1?b=this.options.grid.y.startAt:b=a;for(var c=0;c<this.data.series.length;c++)for(var d=0;d<this.data.series[c].data.length;d++)tmp=parseFloat(this.data.series[c].data[d]),tmp>a&&(a=tmp),tmp<b&&(b=tmp);var e={minValue:0,maxValue:0,step:0,tickers:0};if(b==0&&b==a)e.tickers=2,e.minValue=0,e.maxValue=1,e.step=this.options.height-this.options.gutter.top-this.options.gutter.bottom;else{var f=b==a?this.utils.niceNumber(Math.abs(a),!1):this.utils.niceNumber(a-b,!1),g=this.utils.niceNumber(f/this.options.grid.y.range,!0),h=Math.max(-Math.floor(Math.LOG10E*Math.log(g)),0),i=this.utils.floorToPrecision(b/g,h)*g,j=this.utils.roundToPrecision(this.utils.niceNumber(.5*g,!0),h),k=this.utils.roundToPrecision(g,h);b<0?i-=j:i=Math.max(i-j,0),b!==a&&(i=this.utils.roundToOrigin(i,1)),e.maxValue>=0&&e.minValue<=0?e.maxValue=0:e.maxValue=i;while(e.maxValue<=a)e.maxValue+=k;e.tickers=0,e.minValue=e.maxValue;while(e.minValue>b)e.minValue-=k,e.tickers++;e.step=(this.options.height-this.options.gutter.top-this.options.gutter.bottom)/(e.maxValue-e.minValue)}this.draw.coord.scale.y=e,this.draw.coord.scale.x.step=(this.options.width-(this.options.offset.left+this.options.offset.right)-(this.options.gutter.left+this.options.gutter.right))/this.data.labels.x.length,this.draw.coord.scale.x.tickers=this.data.labels.x.length},a.prototype.drawLegendRight=function(){var a=this.draw.paper.set(),b=this.options.width-this.options.gutter.right,c=this.options.gutter.top+.5;for(var d=0,e=this.data.countSerie;d<e;d++){var f=this.draw.paper.set(),g=this.options.color.serie[d%this.options.color.serie.length],h=this.draw.paper.rect(b,c,15,15,5).attr({fill:g,stroke:g,"stroke-width":0,"stroke-opacity":0}).setRealColor(g);this.draw.matrice[h.id]={id:h.id,serieSetId:d};var i=this.draw.paper.text(b+25,c+10).attr({"text-anchor":"start"}).attr(this.options.legend.render(this.data.series[d].name));this.draw.matrice[i.id]={id:i.id,serieSetId:d},c+=25,f.push(h),f.push(i),this.clickLegend(f),c>=this.options.height-this.options.gutter.top-this.options.gutter.bottom&&(c=this.options.gutter.top+.5,b+=a.getBBox().width+10),a.push(f)}a.translate(-a.getBBox().width,0),a.getBBox().width>=this.options.gutter.right&&(this.options.gutter.right=a.getBBox().width+15),a.translate(0,(this.options.height-this.options.gutter.top-this.options.gutter.bottom-a.getBBox().height)/2),this.draw.sets.legend=a},a.prototype.drawLegendTop=function(){var a=this.draw.paper.set(),b=this.options.gutter.left+.5,c=this.options.gutter.top+.5;for(var d=0,e=this.data.countSerie;d<e;d++){var f=this.draw.paper.set(),g=this.options.color.serie[d%this.options.color.serie.length],h=this.draw.paper.rect(b,c,15,15,5).attr({fill:g,stroke:g,"stroke-width":0,"stroke-opacity":0}).setRealColor(g);this.draw.matrice[h.id]={id:h.id,serieSetId:d},b+=25;var i=this.draw.paper.text(b,c+10).attr({"text-anchor":"start"}).attr(this.options.legend.render(this.data.series[d].name));this.draw.matrice[i.id]={id:i.id,serieSetId:d},b+=i.getBBox().width+10,f.push(h),f.push(i),this.clickLegend(f),b>=this.options.width-this.options.gutter.left-this.options.gutter.right&&(c+=25,b=this.options.gutter.left+.5),a.push(f)}a.getBBox().height>=this.options.gutter.top&&(this.options.gutter.top=a.getBBox().height+15),a.translate((this.options.width-this.options.gutter.left-this.options.gutter.right-a.getBBox().width)/2,0),this.draw.sets.legend=a},a.prototype.drawGrid=function(){var a=this.options.gutter.left+.5,b=this.options.gutter.top+.5,c=this.options.width-(this.options.gutter.left+this.options.gutter.right),d=this.options.height-this.options.gutter.top-this.options.gutter.bottom;if(this.options.grid.draw.box){var e=["M",Math.round(a)+.5,Math.round(b)+.5,"L",Math.round(a+c-2)+.5,Math.round(b)+.5,Math.round(a+c-2)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b)+.5];this.draw.grid.box=this.draw.paper.path(e.join(",")).attr({stroke:this.options.color.grid,opacity:.3})}if(this.options.grid.draw.y){var f=d/this.draw.coord.scale.y.tickers,g=this.draw.paper.set();for(var h=0;h<=this.draw.coord.scale.y.tickers;h++)h<this.draw.coord.scale.y.tickers?(line=this.draw.paper.path(["M",a,Math.round(b+h*f)+.5,"l",c,0]).attr({fill:"none",stroke:this.options.color.grid,"stroke-dasharray":"- ",opacity:.3}),g.push(line)):(line=this.draw.paper.path(["M",a,Math.round(b+h*f)+.5,"l",c,0]).attr({stroke:this.options.color.grid,opacity:.3}),g.push(line));this.draw.grid.y=g}if(this.options.grid.draw.x){var i=this.draw.paper.set();for(var h=0;h<=this.draw.coord.scale.x.tickers;h++)line=this.draw.paper.path(["M",this.draw.coord.origin.X+this.draw.coord.scale.x.step*(h+.5),b,"l",0,d]).attr({fill:"none",stroke:this.options.color.grid,"stroke-dasharray":"- ",opacity:.3}),i.push(line);line=this.draw.paper.path(["M",a,b,"l",0,d]).attr({stroke:this.options.color.grid,opacity:.3}),i.push(line),this.draw.grid.x=i}this.options.grid.x.labels.draw&&(this.draw.sets.labels.x=this.drawLabelX()),this.options.grid.y.labels.draw&&(this.draw.sets.labels.y=this.drawLabelY())},a.prototype.drawLabelX=function(){var a=this.draw.paper.set();for(var b=0,c=this.data.labels.x.length;b<c;b++)if(this.options.grid.x.labels.ticker===!1||b%this.options.grid.x.labels.ticker==0){var d=this.draw.coord.origin.X+this.draw.coord.scale.x.step*(b+.5),e=this.draw.paper.text(d,this.options.height-this.options.gutter.bottom+10).attr(this.options.grid.x.labels.render(this.data.labels.x[b])).toBack();a.push(e)}return this.options.grid.x.legend.show==1&&(e=this.draw.paper.text(this.options.width/2,this.options.height-10).attr({"text-anchor":"middle"}).attr(this.options.grid.x.legend).toBack(),a.push(e)),a},a.prototype.drawLabelY=function(){var a=this.draw.coord.scale.y.minValue,b=this.draw.coord.scale.y.maxValue,c=this.draw.coord.scale.y.tickers,d=(this.options.height-this.options.gutter.top-this.options.gutter.bottom)/c,e=(b-a)/c,f=this.draw.paper.set();for(var g=0;g<=c;g++){var h=Math.round(Math.round(this.options.gutter.top+.5+g*d)),i=this.draw.paper.text(this.options.gutter.left-5,h).attr({"text-anchor":"end"}).attr(this.options.grid.y.labels.render(e*(c-g)+a)).toBack();f.push(i)}return this.options.grid.y.legend.show==1&&(i=this.draw.paper.text(10,this.options.height/2).attr({"text-anchor":"middle",transform:"r270"}).attr(this.options.grid.y.legend).toBack(),f.push(i)),f},a.prototype.drawLine=function(a,b,c){var d=this.draw.paper.set(),e=this.data.series[a].data;for(var f=0,g=e.length;f<g;f++){var h=e[f],i=c(a,f),j=this.draw.coord.origin.Y+this.draw.coord.scale.y.step*(this.draw.coord.scale.y.maxValue-h),k=this.draw.coord.origin.X+i.xFactor*i.xScale,l=this.draw.paper.circle(k,j,this.options.graph.dot.normal).attr({fill:this.options.color.dot.fill,stroke:b,"stroke-width":2});d.push(l),this.draw.matrice[l.id]={id:l.id,serieSetId:a,transverseSetId:f},this.draw.dots.push({id:l.id,dot:l,x:a,y:f}),this.draw.tooltips[l.id]=this.drawTooltipForPlot(l,a,f);if(typeof this.draw.sets.transverses[f]=="undefined"){var m=this.draw.paper.set();m.push(l),this.draw.sets.transverses.push(m)}else this.draw.sets.transverses[f].push(l)}return pathes=this.joinPlots(a,d),{plots:d,lines:pathes}},a.prototype.joinPlots=function(a,b){var c,d,e=b[0].attrs.stroke;c=this.draw.paper.set();var f=this.draw.paper.path();for(var g=0,h=b.length;g<h;g++)g===0?f.moveTo(b[g].attrs.cx,b[g].attrs.cy):this.options.graph.curve?f.cplineTo(b[g].attrs.cx,b[g].attrs.cy,this.options.graph.curve):f.lineTo(b[g].attrs.cx,b[g].attrs.cy),this.draw.matrice[f.id]={id:f.id,serieSetId:a,transverseSetId:g},f.attr({stroke:e,"stroke-width":this.options.graph.line.strokeWidth,"stroke-linejoin":"round"});return b.toFront(),c.push(f),c},a.prototype.drawColumns=function(a,b,c){var d=this.draw.paper.set(),e=this.data.series[a].data;for(var f=0,g=e.length;f<g;f++){var h=e[f],i=c(a,f),j=this.draw.coord.origin.Y+this.draw.coord.scale.y.step*(this.draw.coord.scale.y.maxValue-Math.max(0,this.draw.coord.scale.y.minValue))+1,k=this.draw.coord.origin.Y+this.draw.coord.scale.y.step*(this.draw.coord.scale.y.maxValue-h),l=Math.abs(k-j),m=this.draw.coord.origin.X+i.xFactor*i.xScale,n=this.draw.paper.rect(m,Math.min(k,j),i.xScale-2,l).attr({fill:b,stroke:b,"stroke-width":0});d.push(n),this.draw.matrice[n.id]={id:n.id,serieSetId:a,transverseSetId:f},this.draw.dots.push({id:n.id,dot:n,x:a,y:f}),this.draw.tooltips[n.id]=this.drawTooltipForColumn(n,a,f);if(typeof this.draw.sets.transverses[f]=="undefined"){var o=this.draw.paper.set();o.push(n),this.draw.sets.transverses.push(o)}else this.draw.sets.transverses[f].push(n)}return d},a.prototype.drawTooltipForPlot=function(a,b,c){var d,e;e=this.draw.paper.set();var f=this.draw.paper.text(160,0,"").attr({text:this.options.tooltip(this.data,b,c).title+"\n"+this.options.tooltip(this.data,b,c).sub}).attr(this.options.textes.tooltip.title);e.push(f);var g="right",h=a.attrs.cx+4,i=a.attrs.cy;a.attrs.cx+e.getBBox().width>this.options.width&&(g="left",h-=8),d=this.draw.paper.popup(h,i,e,g,!0);var j=this.draw.paper.path().attr({path:d.path,fill:"#000",stroke:"#666","stroke-width":2,"fill-opacity":.7}).translate(d.dx,d.dy);return e.translate(d.dx,d.dy).toFront(),this.draw.paper.set(j,e).hide()},a.prototype.drawTooltipForColumn=function(a,b,c){var d,e;e=this.draw.paper.set();var f=this.draw.paper.text(160,0,"").attr({text:this.options.tooltip(this.data,b,c).title+"\n"+this.options.tooltip(this.data,b,c).sub}).attr(this.options.textes.tooltip.title);e.push(f);var g="top",h=a.attrs.x+a.attrs.width/2,i=a.attrs.y-1;a.attrs.cy-e.getBBox().height<0&&(g="bottom",h+=2),d=this.draw.paper.popup(h,i,e,g,!0);var j=this.draw.paper.path().attr({path:d.path,fill:"#000",stroke:"#666","stroke-width":2,"fill-opacity":.7}).translate(d.dx,d.dy);return e.translate(d.dx,d.dy).toFront(),this.draw.paper.set(j,e).hide()},a.prototype.fillPathes=function(){var a=this.draw.coord.origin.Y+this.draw.coord.scale.y.step*(this.draw.coord.scale.y.maxValue-0)+1.5;for(var b=0;b<this.draw.sets.pathes.length;b++){if(this.draw.sets.pathes[b][0].type=="path"){var c=this.draw.sets.pathes[b][0].attrs.stroke,d=this.draw.sets.pathes[b][0].attrs.path;d.push(["L",d[d.length-1][1],a]),d.push(["L",d[0][1],a]);var e=this.draw.paper.path().attr({path:d,fill:c,stroke:c,opacity:.4,"stroke-width":0,"stroke-linejoin":"round"})}this.draw.sets.pathes[b].push(e)}},a.prototype.sortSeries=function(){function g(a,b){return a.value<b.value?1:a.value>b.value?-1:0}var a=this.draw.sets.series,b=this.draw.sets.pathes,c=[];for(var d=0;d<this.data.series.length;d++){var e=0;for(var f=0;f<this.data.series[d].data.length;f++)e+=parseFloat(this.data.series[d].data[f]);e/=this.data.series[d].data.length,c.push({idSerie:d,value:e})}c.sort(g);for(var h=0,i=c.length;h<i;h++)b[c[h].idSerie].toFront(),a[c[h].idSerie].toFront()},a.prototype.drawTransverses=function(){var a;for(var b=0;b<this.draw.sets.transverses.length;b++){a=["M"];for(var c=0,d=this.draw.sets.transverses[b].items.length-1;c<d;c++){var e=this.draw.sets.transverses[b].items[c].attrs,f=this.draw.sets.transverses[b].items[c+1].attrs;c==0&&(a=a.concat(["M",e.cx,e.cy,"L"])),a=a.concat([e.cx,e.cy,f.cx,f.cy])}var g=this.draw.paper.path(a).attr({stroke:this.options.color.transverse,"stroke-width":this.options.graph.line.strokeWidth,"stroke-linejoin":"round"}).hide().toBack();this.draw.sets.transverses[b].push(g)}this.draw.grid.x&&this.draw.grid.x.toBack(),this.draw.grid.y&&this.draw.grid.y.toBack()},a.prototype.hover=function(a){var b=this;a.hover(function(){this.type=="circle"&&(this.attr("r",b.options.graph.dot.hover),b.draw.tooltips[this.id].show().toFront()),this.type=="rect"&&(this.attr("fill-opacity",.7),b.draw.tooltips[this.id].show().toFront())},function(){this.type=="circle"&&(this.attr("r",b.options.graph.dot.normal),b.draw.tooltips[this.id].hide()),this.type=="rect"&&(this.attr("fill-opacity",1),b.draw.tooltips[this.id].hide())})},a.prototype.clickLegend=function(a){var b=this;a.click(function(){var a=b.draw.matrice[this.id].serieSetId;b.draw.sets.series[a][0].node.style.display=="none"?(b.draw.sets.legend[a][0].attr({fill:b.draw.sets.legend[a][0]._realColor}),b.draw.sets.series[a].show(),b.draw.sets.pathes[a]&&b.draw.sets.pathes[a].show()):(b.draw.sets.legend[a][0].attr({fill:"#AAA"}),b.draw.sets.series[a].hide(),b.draw.sets.pathes[a]&&b.draw.sets.pathes[a].hide())})},a.prototype.utils={trim:function(a){var a=a.replace(/^\s\s*/,""),b=/\s/,c=a.length;while(b.test(a.charAt(--c)));return a.slice(0,c+1)},extend:function(a,b){for(var c in b)a[c]?Object.prototype.toString.call(b[c])=="[object Object]"?a[c]=this.extend(a[c],b[c]):a[c]=b[c]:a[c]=b[c];return this.clone(a)},clone:function b(a){if(typeof a!="object"||a==null)return a;var c=a.constructor();for(var d in a)c[d]=b(a[d]);return c},roundToPrecision:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},floorToPrecision:function(a,b){var c=Math.pow(10,b);return Math.floor(a*c)/c},ceilToPrecision:function(a,b){var c=Math.pow(10,b);return Math.ceil(a*c)/c},niceNumber:function(a,b){var c=Math.floor(Math.LOG10E*Math.log(a)),d,e,f;return c<0?d=parseFloat(Math.pow(10,c).toFixed(Math.abs(c))):d=Math.pow(10,c),e=a/d,b?e<1.5?f=1:e<3?f=2:e<7?f=5:f=10:e<=1?f=1:e<=2?f=2:e<=5?f=5:f=10,f*d},roundToOrigin:function(a,b){var c=a,d;return b=b||1,d=Math.pow(10,-b),c=Math.round(a*d)/d,c>this.min?this.roundToOrigin(a-this.step):c}},a.prototype.defaultOptions={data:"",container:"",width:640,height:400,auto_adjust:!1,legend:{display:"top",render:function(a){return{font:"10px Helvetica, Arial",fill:"#333","font-weight":"bold",text:a}}},offset:{top:20,right:20,bottom:20,left:20},gutter:{top:10,right:10,bottom:40,left:50},grid:{y:{range:10,startAt:!1,labels:{draw:!0,ticker:!0,render:function(a){return{font:"10px Helvetica, Arial",fill:"#333",text:a}}},legend:{text:"Y-values",font:"14px Helvetica, Arial","font-weight":"bold",fill:"#333",show:!0}},x:{labels:{draw:!0,ticker:!0,render:function(a){return{font:"10px Helvetica, Arial",fill:"#333",text:a}}},legend:{text:"X-values",font:"14px Helvetica, Arial",fill:"#333","font-weight":"bold",show:!0}},draw:{box:!1,y:!0,x:!1}},textes:{axis:{x:{labels:{font:"10px Helvetica, Arial",fill:"#333"},legend:{show:!0,font:"12px Helvetica, Arial",fill:"#333"}}},tooltip:{title:{font:"12px Helvetica, Arial",fill:"#fff"},sub:{font:"10px Helvetica, Arial",fill:"#fff"}},legend:{font:"12px Helvetica, Arial",fill:"#fff"}},tooltip:function(a,b,c){return{title:a.series[b].name,sub:a.series[b].data[c]}},color:{serie:["#1589B2","#A2CC06","#CC33CC","#FF9933","#4FAC24","#00CCCC","#FF0066"],transverse:"green",dot:{fill:"#EEE"},grid:"#333"},graph:{curve:0,dot:{normal:4,hover:6},line:{strokeWidth:4}}},a}(),Line=function(){return function(b){var c=new Choopy(b);c.parse(),c.normalize(),c.initDraw(),c.drawGrid();var d,e=function(a,b){return{xScale:c.draw.coord.scale.x.step,xFactor:.5+b}};for(var f=0,g=c.data.countSerie;f<g;f++){var h=c.options.color.serie[f%c.options.color.serie.length];d=c.drawLine(f,h,e),d.plots.toFront(),c.draw.sets.series.push(d.plots),c.draw.sets.pathes.push(d.lines)}for(var f=0,g=c.draw.sets.series.length;f<g;f++)c.hover(c.draw.sets.series[f])}}(),Sparkarea=function(b){var c=new Choopy(b);c.parse();var d=function(a){tmp=[];for(var b=0;b<a;b++)tmp.push(b+"");return tmp};c.data.labels.x=d(c.data.longestSerie),c.options.graph.dot.normal=0,c.options.graph.dot.hover=0,c.options.graph.line.strokeWidth=2,c.options.legend.display=!1,c.setOptions({offset:{top:0,right:0,bottom:0,left:0},gutter:{top:0,right:0,bottom:0,left:0}}),c.initDraw();var e,f=function(a,b){return{xScale:c.draw.coord.scale.x.step,xFactor:.5+b}};for(var g=0,h=c.data.countSerie;g<h;g++){var i=c.options.color.serie[g%c.options.color.serie.length];e=c.drawLine(g,i,f),e.plots.toFront(),c.draw.sets.series.push(e.plots),c.draw.sets.pathes.push(e.lines)}c.fillPathes()},Sparkbar=function(b){var c=new Choopy(b);c.parse();var d=function(a){tmp=[];for(var b=0;b<a;b++)tmp.push(b+"");return tmp};c.data.labels.x=d(c.data.longestSerie),c.options.graph.dot.normal=0,c.options.graph.dot.hover=0,c.options.graph.line.strokeWidth=2,c.options.legend.display=!1,c.setOptions({offset:{top:0,right:0,bottom:0,left:0},gutter:{top:0,right:0,bottom:0,left:0}}),c.initDraw();var e,f=function(a,b){return{xScale:c.draw.coord.scale.x.step,xFactor:b}};for(var g=0,h=c.data.countSerie;g<h;g++){var i=c.options.color.serie[g%c.options.color.serie.length];e=c.drawColumns(g,i,f),e.toFront(),c.draw.sets.series.push(e.plots),c.draw.sets.pathes.push(e.lines)}},Sparkline=function(b){var c=new Choopy(b);c.parse();var d=function(a){tmp=[];for(var b=0;b<a;b++)tmp.push(b+"");return tmp};c.data.labels.x=d(c.data.longestSerie),c.options.graph.dot.normal=0,c.options.graph.dot.hover=0,c.options.graph.line.strokeWidth=2,c.options.legend.display=!1,c.setOptions({offset:{top:0,right:0,bottom:0,left:0},gutter:{top:0,right:0,bottom:0,left:0}}),c.initDraw();var e,f=function(a,b){return{xScale:c.draw.coord.scale.x.step,xFactor:.5+b}};for(var g=0,h=c.data.countSerie;g<h;g++){var i=c.options.color.serie[g%c.options.color.serie.length];e=c.drawLine(g,i,f),e.plots.toFront(),c.draw.sets.series.push(e.plots),c.draw.sets.pathes.push(e.lines)}}